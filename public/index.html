<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VoxTalk</title>
  <style>
    #stopButton {
      position: fixed;
      top: 10px;
      right: 10px;
      opacity: 0.7;
      padding: 8px 16px;
      background: #ff4444;
      color: white;
      border: none;
      border-radius: 4px;
      z-index: 1000;
      cursor: pointer;
      font-weight: bold;
      display: none;
    }
  </style>
</head>
<body>
  <h1>VoxTalk</h1>
  <button id="startButton">Start Session</button>
  <button id="stopButton">STOP</button>
  <div id="status"></div>
  <audio id="audioPlayer" controls style="display:none;"></audio>
  <script>
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const audioPlayer = document.getElementById('audioPlayer');
    const statusDiv = document.getElementById('status');

    let currentAudioFetchController = null;

    startButton.onclick = async () => {
      statusDiv.innerText = 'Starting session...';
      stopButton.style.display = 'none';

      // Start session and get greeting (simulate: you may need to fetch TTS audio here)
      const response = await fetch('/session', { method: 'POST' });
      const session = await response.json();

      // Simulate TTS audio fetch (replace with actual API/audio)
      // For demo: use a short mp3, or replace with your TTS fetch logic
      // We'll use a placeholder audio for demonstration purposes:
      const audioUrl = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';

      audioPlayer.src = audioUrl;
      audioPlayer.play();
      stopButton.style.display = 'inline-block';
      statusDiv.innerText = 'VoxTalk is speaking.';

      // If you stream audio via fetch: save controller so you can abort on STOP
      // Example:
      // currentAudioFetchController = new AbortController();
      // fetch('your_audio_stream_url', { signal: currentAudioFetchController.signal });
    };

    stopButton.onclick = () => {
      // Immediate stop: pause and reset audio
      audioPlayer.pause();
      audioPlayer.currentTime = 0;
      stopButton.style.display = 'none';
      statusDiv.innerText = 'Speech stopped.';

      // If streaming via fetch, abort request
      if (currentAudioFetchController) {
        currentAudioFetchController.abort();
        currentAudioFetchController = null;
      }
    };
  </script>
</body>
</html>
