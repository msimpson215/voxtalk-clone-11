<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VoxTalk‚Ñ¢ ‚Ä¢ Clone 11 Connected</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Header -->
  <header class="topbar">
    <h1 class="brand">VoxTalk<sup>‚Ñ¢</sup></h1>
    <nav class="nav-buttons">
      <button class="pill ghost" onclick="openModal('cartModal')">Cart</button>
      <button class="pill ghost" onclick="openModal('infoModal')">Info</button>
      <button class="pill ghost" onclick="openModal('checkoutModal')">Checkout</button>
    </nav>
  </header>

  <!-- Halo -->
  <main class="stage">
    <button id="haloBtn" class="halo-btn" aria-pressed="false">
      <div class="halo ring r1"></div>
      <div class="halo ring r2"></div>
      <div class="halo ring r3"></div>
      <span class="halo-label">Click&nbsp;to&nbsp;Talk</span>
    </button>
  </main>

  <!-- Classic Chat -->
  <section class="quiet">
    <form id="quietForm" class="quiet-form" autocomplete="off">
      <input id="quietInput" class="quiet-input" type="text"
             placeholder="Classic Chat ‚Äî type your question here..." />
      <div class="quiet-controls">
        <button id="micBtn" class="pill mic-btn" type="button" aria-label="Microphone">üé§</button>
        <button id="sendBtn" class="pill send-btn" type="submit">Send</button>
      </div>
    </form>
    <div id="thread" class="thread"></div>
  </section>

  <!-- Corner Buttons -->
  <button id="printBtn" class="corner-btn left" onclick="window.print()">Print Conversation</button>
  <a id="humanBtn" class="corner-btn right" href="tel:18005551234">Contact Human</a>

  <!-- ---------- Modals ---------- -->
  <div id="cartModal" class="modal hidden">
    <div class="modal-content">
      <h2>Cart</h2>
      <p>Cart preview goes here. (Demo content)</p>
      <button class="pill" onclick="closeModal('cartModal')">Close</button>
    </div>
  </div>

  <div id="checkoutModal" class="modal hidden">
    <div class="modal-content">
      <h2>Checkout</h2>
      <p>Checkout preview goes here. (Demo content)</p>
      <button class="pill" onclick="closeModal('checkoutModal')">Close</button>
    </div>
  </div>

  <div id="infoModal" class="modal hidden">
    <div class="modal-content">
      <h2>About VoxTalk</h2>
      <p>Talk or type ‚Äî whichever you prefer. VoxTalk aims to be a calm, capable partner.</p>
      <p class="note">Click outside this box to return.</p>
      <button class="pill" onclick="closeModal('infoModal')">Close</button>
    </div>
  </div>

  <!-- ---------- Scripts ---------- -->
  <script>
    // Modal handling
    function openModal(id){ const el=document.getElementById(id); if(el) el.classList.remove('hidden'); }
    function closeModal(id){ const el=document.getElementById(id); if(el) el.classList.add('hidden'); }
    document.querySelectorAll('.modal').forEach(m =>
      m.addEventListener('click', e => { if(e.target===m) m.classList.add('hidden'); })
    );

    // Placeholder logic
    const input=document.getElementById('quietInput');
    input.addEventListener('focus',()=>input.placeholder='');
    input.addEventListener('blur',()=>{if(!input.value) input.placeholder='Classic Chat ‚Äî type your question here...';});

    // ----- Chat Connection -----
    const form = document.getElementById("quietForm");
    const inputEl = document.getElementById("quietInput");
    const threadEl = document.getElementById("thread");
    const sendBtn = document.getElementById("sendBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const prompt = inputEl.value.trim();
      if (!prompt) return;

      appendLine("user", prompt);
      inputEl.value = "";
      sendBtn.disabled = true;

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        });
        const data = await res.json();
        appendLine("vox", data.reply || "No reply received.");
      } catch (err) {
        appendLine("vox", "‚ö†Ô∏è Connection error ‚Äî try again.");
      } finally {
        sendBtn.disabled = false;
      }
    });

    function appendLine(role, text) {
      const line = document.createElement("div");
      line.className = "msg " + role;
      line.textContent = (role === "user" ? "You: " : "VoxTalk: ") + text;
      threadEl.appendChild(line);
      threadEl.scrollTop = threadEl.scrollHeight;
    }
  </script>
</body>
</html>
