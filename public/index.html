<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>VoxTalk (Soothing Radiance)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="data:,">
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app">
<p class="demo-label">Soothing Radiance</p>
<h1>Talk to VoxTalk</h1>
<button id="pttBtn" aria-pressed="false"></button>
<div class="hint">Click to Talk</div>
<button id="printBtn" class="print-btn">üñ®Ô∏è Print Conversation</button>
<audio id="remote" autoplay playsinline></audio>
</div>

<div id="conversation-panel" style="display:none;">
<div id="conversation"></div>
</div>

<div id="spotlight-card"></div>

<script>
const pttBtn = document.getElementById('pttBtn');
const rtAudio = document.getElementById('remote');
const printBtn = document.getElementById('printBtn');
const conversationPanel = document.getElementById('conversation-panel');
const conversationDiv = document.getElementById('conversation');
const spotlightCard = document.getElementById('spotlight-card');

let conversationLines = [];
let userTranscript = "";
let aiTranscript = "";

function setSpeaking(on) {
pttBtn.classList.toggle('speaking', on);
}

function printConversation() {
conversationDiv.innerHTML = "";
conversationLines.forEach(line => {
const div = document.createElement("div");
div.textContent = (line.role === "user" ? "You: " : "VoxTalk: ") + line.text;
conversationDiv.appendChild(div);
});
conversationPanel.style.display = "block";
setTimeout(() => {
window.print();
conversationPanel.style.display = "none";
}, 250);
}

function showProduct(name, price, imageUrl, linkUrl) {
spotlightCard.innerHTML = `
<img src="${imageUrl}" alt="${name}">
<div class="info">
<h3>${name}</h3>
<p>Price: ${price}</p>
<a href="${linkUrl}" target="_blank">View Product</a>
<a href="${linkUrl}?add-to-cart=1" target="_blank">Add to Cart</a>
</div>
`;
spotlightCard.classList.add("visible");
}

let pc = null;
let micTrack = null;

async function initRealtime() {
try {
const s = await fetch("/session", { method:"POST" });
const { client_secret, model, voice } = await s.json();

if (pc) {
pc.close();
pc = null;
}

pc = new RTCPeerConnection();
const mic = await navigator.mediaDevices.getUserMedia({ audio:true });
micTrack = mic.getTracks()[0];
micTrack.enabled = false;
pc.addTrack(micTrack, mic);

pc.ontrack = (ev)=> {
rtAudio.srcObject = ev.streams[0];
rtAudio.play().catch(()=>{});
};

const dc = pc.createDataC
