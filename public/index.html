<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VoxTalkâ„¢ Clone-11 Reset</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <h1 class="brand">VoxTalk<sup>â„¢</sup></h1>
    <nav class="nav-buttons">
      <button class="pill">Cart</button>
      <button class="pill">Info</button>
      <button class="pill">Checkout</button>
    </nav>
  </header>

  <main class="stage">
    <button id="haloBtn" class="halo-btn">
      <div class="halo ring r1"></div>
      <div class="halo ring r2"></div>
      <div class="halo ring r3"></div>
      <span class="halo-label">Click&nbsp;to&nbsp;Talk</span>
    </button>
    <audio id="remote" autoplay playsinline></audio>
  </main>

  <section class="quiet">
    <form id="quietForm" class="quiet-form" autocomplete="off">
      <input id="quietInput" class="quiet-input" type="text"
             placeholder="Classic Chat â€” type your question..." />
      <div class="quiet-controls">
        <button id="micBtn" class="pill mic-btn" type="button">ðŸŽ¤</button>
        <button id="sendBtn" class="pill send-btn" type="submit">Send</button>
      </div>
    </form>
  </section>

  <button class="corner-btn left" onclick="window.print()">Print Conversation</button>
  <a class="corner-btn right" href="tel:18005551234">Contact Human</a>

  <script>
  const haloBtn = document.getElementById("haloBtn");
  const remote = document.getElementById("remote");
  let pc;

  haloBtn.onclick = async () => {
    haloBtn.disabled = true;
    haloBtn.querySelector(".halo-label").textContent = "Connecting...";

    const resp = await fetch("/session", { method: "POST" });
    const data = await resp.json();
    if (!data?.client_secret?.value) {
      haloBtn.querySelector(".halo-label").textContent = "Error";
      console.error("Session failed:", data);
      return;
    }

    pc = new RTCPeerConnection();
    pc.ontrack = (e) => (remote.srcObject = e.streams[0]);
    const local = await navigator.mediaDevices.getUserMedia({ audio: true });
    local.getTracks().forEach((t) => pc.addTrack(t, local));

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);

    const r2 = await fetch(
      "https://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview",
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${data.client_secret.value}`,
          "Content-Type": "application/sdp"
        },
        body: offer.sdp
      }
    );

    const answer = { type: "answer", sdp: await r2.text() };
    await pc.setRemoteDescription(answer);

    haloBtn.querySelector(".halo-label").textContent = "Live";
  };
  </script>
</body>
</html>
